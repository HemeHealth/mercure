{% extends "base.html" %}

{% block title %}Modules{% endblock %}

{% block content %}
<main role="main">
    <div class="container">
        <h1 class="title">Processing Modules - {{module_name}}</h1>

        <div class="notification is-danger" id="erroralert" style="display: none;">
            <i class="fas fa-bug"></i>&nbsp;&nbsp;Error in configuration detected. Please check input fields for correct
            syntax.
        </div>

        <form method="post" onsubmit="return validate()">
            <div class="field">
                <label class="label" for="docker_tag">Docker tag</label>
                <p class="control">
                    <input class="input" id="docker_tag" required type="text" placeholder="Docker tag" name="docker_tag"
                        value="{{module['docker_tag']}}">
                </p>
            </div>
            <div class="field">
                <label class="label" for="additional_volumes">Additional volumes</label>
                <p class="control">
                    <input class="input"
                           id="additional_volumes"
                           type="text"
                           placeholder="{&quot;/host&quot;: {&quot;bind&quot;: &quot;/config&quot;, &quot;mode&quot;: &quot;r&quot;}}"
                           name="additional_volumes"
                           value="{{module['additional_volumes']}}">
                </p>
            </div>
            <div class="field">
                <label class="label" for="environment">Environment variables</label>
                <p class="control">
                    <input class="input"
                           id="environment"
                           type="text"
                           placeholder="{foo=&quot;bar&quot;}"
                           name="environment"
                           value="{{module['environment']}}">
                </p>
            </div>
            <div class="field">
                <label class="label" for="docker_arguments">Other Docker arguments</label>
                <p class="control">
                    <input class="input"
                           id="docker_arguments"
                           type="text"
                           placeholder="See https://docker-py.readthedocs.io/en/stable/containers.html for parameters"
                           name="docker_arguments"
                           value="{{module['docker_arguments']}}">
                </p>
            </div>
            <div class="field">
                <label class="label" for="server_group">Server group</label>
                <p class="control">
                    <input class="input"
                           id="server_group"
                           type="text"
                           placeholder="Required server type. Leave empty for any"
                           name="server_group"
                           value="{{module['server_group']}}">
                </p>
            </div>
            <div class="field" style="margin-top: 40px;">
                <label class="label" for="settings">Settings</label>
                <div class="control">
                    <textarea name="settings" id="settings" class="textarea"
                        autocomplete='off' rows="9"
                        placeholder="Global module settings">{{settings}}</textarea>
                </div>
            </div>
            
            <div class="field" style="margin-top: 40px;">
                <label class="label" for="constraint">Constraints</label>
                <div class="control">
                    <textarea name="constraint" id="constraint" class="textarea"
                        autocomplete='off' rows="9"
                        placeholder="Module constraints">{{module.constraint}}</textarea>
                </div>
            </div>   
            <div class="field" style="margin-top: 40px;">
                <label class="label" for="resources">Resource requirements</label>
                <div class="control">
                    <textarea name="resources" id="resources" class="textarea"
                        autocomplete='off' rows="9"
                        placeholder="Module resource requirements">{{module.resources}}</textarea>
                </div>
            </div>   
            <div class="field" style="margin-top: 40px;">
                <label class="label" for="comment">Comment</label>
                <div class="control">
                    <textarea name="comment" id="comment" class="textarea"
                        autocomplete='off' rows="3"
                        placeholder="Module description">{{module['comment']}}</textarea>
                </div>
            </div>            
            <div class="field">
                <label class="label">Contact</label>
                <div class="control">
                    <input name="contact" class="input" autocomplete='off' type="email" placeholder="Email address"
                        value="{{module['contact']}}">
                </div>
            </div>
            <div class="field">
                <p class="control buttons" style="margin-top: 50px;">
                    <button type="submit" class="button is-success" value="default action">
                        <i class="fas fa-save"></i>&nbsp;Save
                    </button>
                    <a class="button" href="/modules"><i class="fas fa-ban"></i>&nbsp;Cancel</a>
                </p>
            </div>
        </form>
    </div>
</main>


<script>
    function validate() {
        var field = "";
        try {
            field = "Settings";
            if ($('#settings').val() == "") {
                $('#settings').val("{}");
            }
            JSON.parse($('#settings').val());
        } catch (e) {
            $('#erroralert').html('<i class="fas fa-bug"></i>&nbsp;&nbsp;Invalid content in field "' + field + '". Please check for correct syntax.');
            $('#erroralert').show();
            if (field == "Settings")
            {
                $('#settings').addClass("is-danger");
                $('#settings').focus();
            }
            return false;
        }
        console.log("PASSED");
        return true;
    }
</script>


{% endblock %}
